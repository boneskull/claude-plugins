#!/bin/bash
# Check if a GitHub PR has been merged
# Usage: gh-pr-merged <owner/repo> <pr-number>

REPO="$1"
PR="$2"

if [[ -z "$REPO" || -z "$PR" ]]; then
  echo "Usage: gh-pr-merged <owner/repo> <pr-number>" >&2
  exit 1
fi

# Requires gh CLI to be installed and authenticated
if ! command -v gh &> /dev/null; then
  echo "gh CLI not installed" >&2
  exit 1
fi

STATE=$(gh pr view "$PR" --repo "$REPO" --json state --jq '.state' 2>/dev/null)

if [[ "$STATE" == "MERGED" ]]; then
  echo "{\"repo\": \"${REPO}\", \"pr\": ${PR}, \"prUrl\": \"https://github.com/${REPO}/pull/${PR}\"}"
  exit 0
else
  exit 1
fi
