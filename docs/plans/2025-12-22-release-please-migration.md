# Release-Please Migration Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Replace the custom claude-plugin-version-bumper action with release-please for automated per-plugin versioning based on conventional commits.

**Architecture:** Each plugin becomes a release-please "package" with its own versioning. The individual `plugin.json` files (which already exist) become the source of truth for versions. The root `marketplace.json` is simplified to only contain `name` and `source` references—no duplicated metadata. Release-please updates each plugin's `plugin.json` via JSONPath when conventional commits warrant a version bump.

**Tech Stack:** release-please, release-please GitHub Action, conventional commits

---

## Background & Context

### Why This Migration?

The `claude-plugin-version-bumper` repo was being built as a custom GitHub Action to handle plugin versioning. However, release-please can do this natively with proper configuration:

1. **Per-plugin versioning** - Each plugin directory is a "package"
2. **Conventional commit parsing** - Already built into release-please
3. **JSONPath updates** - Can update `$.version` in any JSON file
4. **Per-plugin changelogs** - Automatic CHANGELOG.md generation
5. **Monorepo support** - Designed for this exact use case

### Key Insight

Release-please can't update files *outside* a package directory (no `../../` paths allowed). But we don't need to—each plugin already has its own `.claude-plugin/plugin.json` with a version field. The marketplace.json was just duplicating that data unnecessarily.

### Current Structure

```
.claude-plugin/marketplace.json  ← has redundant version for each plugin
plugins/
  bupkis/.claude-plugin/plugin.json  ← has version: "1.0.0"
  github/.claude-plugin/plugin.json  ← has version: "1.0.0"
  refactor/.claude-plugin/plugin.json
  skill-activation/.claude-plugin/plugin.json
  tools/.claude-plugin/plugin.json
  xstate/.claude-plugin/plugin.json
  zod/.claude-plugin/plugin.json
```

### Target Structure

```
.claude-plugin/marketplace.json  ← simplified: just name + source per plugin
plugins/
  bupkis/
    .claude-plugin/plugin.json  ← source of truth for version
    CHANGELOG.md                ← generated by release-please
  (same for all other plugins)
```

---

## Task 1: Create release-please Configuration

**Files:**
- Create: `release-please-config.json`
- Create: `.release-please-manifest.json`

**Step 1: Create release-please-config.json**

```json
{
  "$schema": "https://raw.githubusercontent.com/googleapis/release-please/main/schemas/config.json",
  "separate-pull-requests": true,
  "include-component-in-tag": true,
  "packages": {
    "plugins/bupkis": {
      "release-type": "simple",
      "component": "bupkis",
      "extra-files": [
        {
          "type": "json",
          "path": ".claude-plugin/plugin.json",
          "jsonpath": "$.version"
        }
      ]
    },
    "plugins/github": {
      "release-type": "simple",
      "component": "github",
      "extra-files": [
        {
          "type": "json",
          "path": ".claude-plugin/plugin.json",
          "jsonpath": "$.version"
        }
      ]
    },
    "plugins/refactor": {
      "release-type": "simple",
      "component": "refactor",
      "extra-files": [
        {
          "type": "json",
          "path": ".claude-plugin/plugin.json",
          "jsonpath": "$.version"
        }
      ]
    },
    "plugins/skill-activation": {
      "release-type": "simple",
      "component": "skill-activation",
      "extra-files": [
        {
          "type": "json",
          "path": ".claude-plugin/plugin.json",
          "jsonpath": "$.version"
        }
      ]
    },
    "plugins/tools": {
      "release-type": "simple",
      "component": "tools",
      "extra-files": [
        {
          "type": "json",
          "path": ".claude-plugin/plugin.json",
          "jsonpath": "$.version"
        }
      ]
    },
    "plugins/xstate": {
      "release-type": "simple",
      "component": "xstate",
      "extra-files": [
        {
          "type": "json",
          "path": ".claude-plugin/plugin.json",
          "jsonpath": "$.version"
        }
      ]
    },
    "plugins/zod": {
      "release-type": "simple",
      "component": "zod",
      "extra-files": [
        {
          "type": "json",
          "path": ".claude-plugin/plugin.json",
          "jsonpath": "$.version"
        }
      ]
    }
  }
}
```

**Step 2: Create .release-please-manifest.json**

This tracks current versions. Set to current versions (all 1.0.0):

```json
{
  "plugins/bupkis": "1.0.0",
  "plugins/github": "1.0.0",
  "plugins/refactor": "1.0.0",
  "plugins/skill-activation": "1.0.0",
  "plugins/tools": "1.0.0",
  "plugins/xstate": "1.0.0",
  "plugins/zod": "1.0.0"
}
```

**Step 3: Commit**

```bash
git add release-please-config.json .release-please-manifest.json
git commit -m "chore: add release-please configuration

Configure per-plugin versioning with release-please. Each plugin
is a separate package that gets independent version bumps based
on conventional commits affecting that plugin's directory."
```

---

## Task 2: Simplify marketplace.json

**Files:**
- Modify: `.claude-plugin/marketplace.json`

**Step 1: Update marketplace.json to remove redundant metadata**

Replace the current marketplace.json with a simplified version that only contains `name` and `source` for each plugin:

```json
{
  "description": "Boneskull's personal collection of Claude Code plugins",
  "name": "boneskull-plugins",
  "owner": {
    "name": "boneskull"
  },
  "pluginRoot": "./plugins",
  "plugins": [
    {
      "name": "bupkis",
      "source": "./plugins/bupkis"
    },
    {
      "name": "github",
      "source": "./plugins/github"
    },
    {
      "name": "refactor",
      "source": "./plugins/refactor"
    },
    {
      "name": "skill-activation",
      "source": "./plugins/skill-activation"
    },
    {
      "name": "tools",
      "source": "./plugins/tools"
    },
    {
      "name": "xstate",
      "source": "./plugins/xstate"
    },
    {
      "name": "zod",
      "source": "./plugins/zod"
    }
  ],
  "version": "1.0.0"
}
```

**Step 2: Verify the simplified marketplace still works**

Run: `claude /plugins list` (or however you test plugin discovery)
Expected: All plugins still appear

**Step 3: Commit**

```bash
git add .claude-plugin/marketplace.json
git commit -m "refactor: simplify marketplace.json

Remove redundant metadata from marketplace.json plugin entries.
Each plugin's plugin.json is now the single source of truth for
version, description, author, etc. Marketplace just needs name
and source path."
```

---

## Task 3: Create GitHub Actions Workflow

**Files:**
- Create: `.github/workflows/release-please.yml`

**Step 1: Create the release-please workflow**

```yaml
name: Release Please

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pull-requests: write

jobs:
  release-please:
    runs-on: ubuntu-latest
    steps:
      - uses: googleapis/release-please-action@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
```

**Step 2: Commit**

```bash
git add .github/workflows/release-please.yml
git commit -m "ci: add release-please workflow

Automate version bumping and changelog generation for plugins
based on conventional commits."
```

---

## Task 4: Remove Old release-please Config (if exists)

**Files:**
- Check/Remove: `release-please-config.json` (old version at repo root if different)

**Step 1: Check for conflicting old config**

Run: `cat release-please-config.json` (if it exists and is different from Task 1)

If the old config exists with different content, it was replaced in Task 1.

**Step 2: Verify no duplicate configs**

Run: `find . -name "release-please*.json" -not -path "./node_modules/*"`
Expected: Only `./release-please-config.json` and `./.release-please-manifest.json`

---

## Task 5: Test the Configuration Locally (Optional)

**Step 1: Install release-please CLI**

Run: `npm install -g release-please`

**Step 2: Do a dry-run**

Run: `release-please release-pr --dry-run --repo-url=https://github.com/boneskull/claude-plugins`

Expected: Shows what PR would be created (may show nothing if no releasable commits)

---

## Task 6: Push and Verify

**Step 1: Push to main**

Run: `git push origin main`

**Step 2: Check GitHub Actions**

Go to: https://github.com/boneskull/claude-plugins/actions

Expected: Release Please workflow runs successfully

**Step 3: Make a test commit (optional)**

To trigger a release PR, make a conventional commit that affects a plugin:

```bash
echo "// test" >> plugins/tools/skills/some-skill.md
git add plugins/tools/
git commit -m "feat(tools): add test feature"
git push
```

Expected: Release Please creates a PR to bump tools plugin to 1.1.0

---

## Task 7: Archive claude-plugin-version-bumper Repo

**Files:**
- Update: `boneskull/claude-plugin-version-bumper` repo

**Step 1: Update README to indicate deprecation**

Add to top of README.md:

```markdown
> **DEPRECATED**: This project has been superseded by using release-please directly.
> See [claude-plugins](https://github.com/boneskull/claude-plugins) for the working implementation.
```

**Step 2: Archive the repository**

Go to: https://github.com/boneskull/claude-plugin-version-bumper/settings
Click: "Archive this repository"

---

## Summary

This migration:

1. **Eliminates custom code** - No need for claude-plugin-version-bumper
2. **Uses battle-tested tooling** - release-please is maintained by Google
3. **Simplifies marketplace.json** - Single source of truth in plugin.json
4. **Adds changelogs** - Each plugin gets automatic CHANGELOG.md
5. **Per-plugin releases** - Independent versioning based on affected directories

### Conventional Commit -> Version Bump Mapping

| Commit Type | Version Bump |
|-------------|-------------|
| `feat!:`, `fix!:` (breaking) | Major |
| `feat:` | Minor |
| `fix:`, `perf:` | Patch |
| `chore:`, `docs:`, `style:`, `test:` | No bump |

### Scoping to Plugins

Commits affect a plugin when files in that plugin's directory change. Use scope for clarity:
- `feat(bupkis): add new assertion pattern` - affects bupkis plugin
- `fix(tools): correct typo in skill` - affects tools plugin
